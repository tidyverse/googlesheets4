<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="googlesheets4">
<title>Dates and times • googlesheets4</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.5/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dates and times">
<meta property="og:description" content="googlesheets4">
<meta property="og:image" content="https://googlesheets4.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="googlesheets4.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">googlesheets4</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/googlesheets4.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/read-sheets.html">Read Sheets</a>
    <a class="dropdown-item" href="../articles/write-sheets.html">Write Sheets</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Special topics</h6>
    <a class="dropdown-item" href="../articles/auth.html">googlesheets4 auth</a>
    <a class="dropdown-item" href="../articles/dates-and-times.html">Dates and times</a>
    <a class="dropdown-item" href="../articles/find-identify-sheets.html">Find and identify Sheets</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Connections to other packages</h6>
    <a class="dropdown-item" href="../articles/drive-and-sheets.html">Using googlesheets4 with googledrive</a>
    <a class="dropdown-item" href="../articles/fun-with-googledrive-and-readxl.html">Fun with googledrive and readxl</a>
    <a class="dropdown-item" href="../articles/googlesheets4-reprex.html">How to create a googlesheets4 reprex</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/07/googlesheets4-1-0-0/">googlesheets4 1.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/05/googlesheets4-0-2-0/">googlesheets4 0.2.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyverse/googlesheets4/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Dates and times</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/googlesheets4/blob/HEAD/vignettes/articles/dates-and-times.Rmd" class="external-link"><code>vignettes/articles/dates-and-times.Rmd</code></a></small>
      <div class="d-none name"><code>dates-and-times.Rmd</code></div>
    </div>

    
    
<!-- dates-and-times.Rmd is generated from dates-and-times.Rmd.orig.Rmd. Please edit that file -->
<p>This article provides advice on reading and writing datetimes with
Google Sheets, specifically around the matter of time zones.</p>
<p>A related issue is how datetimes are formatted for presentation in
the Sheet itself. You can read more about these formats in the <a href="https://developers.google.com/sheets/api/guides/formats#date_and_time_format_patterns" class="external-link">Date
and time format patterns section of the Sheets API docs</a>. At the time
of writing, googlesheets4 provides no user-friendly way to address these
formats, although it may do so in the future.</p>
<div class="section level2">
<h2 id="attach-packages-and-do-auth">Attach packages and do auth<a class="anchor" aria-label="anchor" href="#attach-packages-and-do-auth"></a>
</h2>
<p>Attach googlesheets4.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org">googlesheets4</a></span><span class="op">)</span></span></code></pre></div>
<p>Since we eventually create and edit Sheets, we also auth here in a
hidden chunk. If you run this code, you should expect auth to
happen.</p>
<p>The lubridate package (<a href="https://lubridate.tidyverse.org" class="external-link">lubridate.tidyverse.org</a>) is
useful for this exploration, so we attach it now.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-to-work-with-time-zones-in-a-google-sheet">How to work with time zones in a Google Sheet<a class="anchor" aria-label="anchor" href="#how-to-work-with-time-zones-in-a-google-sheet"></a>
</h2>
<p>You don’t.</p>
<p>Literally, you can’t.</p>
<p>I know this sounds very harsh, but it is the truth. Google Sheets
offer essentially no support for time zones and your life will be
simpler if you just make peace with this and accept that you will be
looking at UTC times in Sheets.</p>
<p>A short demo: in R, capture the current time as <code>tt</code> and
reveal the current time zone. Note that <code>tt</code> is displayed in
R according to this time zone.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-04-23 12:48:57 PDT"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/timezones.html" class="external-link">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "America/Vancouver"</span></span></code></pre></div>
<p>Write the <code>tt</code> datetime to a Sheet, configured with the
same time zone as the local R session, and create another cell that
captures the exact text presented in the browser UI for <code>tt</code>.
Read this back into R.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  datetime <span class="op">=</span> <span class="va">tt</span>,</span>
<span>  as_displayed <span class="op">=</span> <span class="fu"><a href="../reference/gs4_formula.html">gs4_formula</a></span><span class="op">(</span><span class="st">"=TO_TEXT(A2)"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span></span>
<span>  <span class="st">"no-time-zone-effect"</span>,</span>
<span>  sheets <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  timeZone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/timezones.html" class="external-link">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating new Sheet: "no-time-zone-effect"</span></span>
<span><span class="co">#&gt;   Spreadsheet name: no-time-zone-effect</span></span>
<span><span class="co">#&gt;                 ID: 1rH4nOOFBFvqCLEcYqaPjMIPj7EHfcT21tLTRL2FbHx0</span></span>
<span><span class="co">#&gt;             Locale: en_US</span></span>
<span><span class="co">#&gt;          Time zone: America/Vancouver</span></span>
<span><span class="co">#&gt;        # of sheets: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Sheet name): (Nominal extent in rows x columns)</span></span>
<span><span class="co">#&gt;          dat: 2 x 2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading from "no-time-zone-effect"</span></span>
<span><span class="co">#&gt; Range "dat"</span></span>
<span><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span><span class="co">#&gt;   datetime            as_displayed       </span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;              &lt;chr&gt;              </span></span>
<span><span class="co">#&gt; 1 2020-04-23 19:48:57 2020-04-23 19:48:58</span></span></code></pre></div>
<p>Note that the <code>tt</code> datetime is displayed differently in
Sheets than it is locally in R. Sheets presents datetimes in Coordinated
Universal Time (time zone Etc/UTC), even if the Sheet’s metadata
specifies a different time zone, such as America/Vancouver.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html" class="external-link">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, <span class="st">"Etc/UTC"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-04-23 19:48:57 UTC"</span></span></code></pre></div>
<p>If you want to understand more about datetimes in R, in Sheets, and
how you can sort of hack around this time zone problem, keep
reading.</p>
</div>
<div class="section level2">
<h2 id="need-to-know-basics-of-datetimes">Need-to-know basics of datetimes<a class="anchor" aria-label="anchor" href="#need-to-know-basics-of-datetimes"></a>
</h2>
<p>Datetimes are a complicated topic. Here we dramatically oversimplify
things, in the name of making a reader who is new to all of this at
least minimally functional.</p>
<p>The main system used to represent times in the computing world is
Unix epoch time:</p>
<blockquote>
<p>A moment in time is represented by the number of seconds that have
elapsed since 1 January 1970 00:00:00 UTC.</p>
</blockquote>
<p>The “UTC” part stands for “Coordinated Universal Time”. Yes, the
order of the letters is strangely different from the words! It’s a great
metaphor for this entire subject, because nothing is as simple as you’d
like. Just accept it and move on. UTC is what you may already think of
as “Greenwich Mean Time”, if you’ve ever encountered that term.</p>
<p>There are three wrinkles we must acknowledge, even when
oversimplifying:</p>
<ol style="list-style-type: decimal">
<li>Time zones. We don’t all live in Greenwich, England, so local times
are described by an offset from UTC.
<ul>
<li>I live in Vancouver, British Columbia, which is 8 hours behind UTC
(UTC−08:00). Or, at least, it is part of the year …</li>
</ul>
</li>
<li>Daylight savings time. Lots of places change their clocks twice a
year. UTC does not! UTC “just is”. This means that your UTC offset is
one number part of the year and another number part of the year.
<ul>
<li>My offset is -08:00 during standard time, but is -07:00 during
daylight savings (roughly March - October).</li>
</ul>
</li>
<li>Spreadsheets are special. Spreadsheets use a different form of epoch
time. Their epoch or origin is usually around 1900 and they keep track
of how many <em>days</em> have elapsed since the epoch (not seconds,
like Unix epoch time). These are sometimes called “serial dates” or
“serial numbers”.
<ul>
<li>Google Sheets use an epoch of 30 December 1899 00:00:00 UTC.<br>
</li>
<li>Horrors I will spare you: different epochs for different spreadsheet
applications (or versions thereof) and the Lotus 1-2-3 leap year
bug.</li>
</ul>
</li>
</ol>
<p>You can read more in the <a href="https://developers.google.com/sheets/api/guides/concepts#datetime_serial_numbers" class="external-link">Sheets
API docs about Date/Time serial numbers</a>.</p>
</div>
<div class="section level2">
<h2 id="datetimes-in-r">Datetimes in R<a class="anchor" aria-label="anchor" href="#datetimes-in-r"></a>
</h2>
<p>R uses Unix epoch time.</p>
<p>R uses the <a href="https://rdrr.io/r/base/DateTimeClasses.html" class="external-link">POSIXct</a> class to
represent datetimes. (Yes, there’s also <code>POSIXlt</code>, but I
recommend and will focus on <code>POSIXct</code>.)</p>
<p>If you ask for the current time, R prints it formatted for your time
zone (or, at least, it tries). You can also ask R to reveal what it
thinks your time zone is.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-04-23 12:49:04 PDT"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/timezones.html" class="external-link">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "America/Vancouver"</span></span></code></pre></div>
<p>The time zone is <strong>purely matter of display</strong>, but it’s
a really nice touch! It is comforting to get a time printed by R that
matches your experience of what time it is, based on looking at the
clock on your wall (“clock time”).</p>
<p>lubridate’s <code><a href="https://lubridate.tidyverse.org/reference/with_tz.html" class="external-link">with_tz()</a></code> function lets you explicitly
associate a datetime with a time zone, e.g. your own or any other time
zone recognized by your system. And this, in turn, affects how the time
is formatted for human eyeballs.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html" class="external-link">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, tzone <span class="op">=</span> <span class="st">"America/Vancouver"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-04-23 12:49:04 PDT"</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html" class="external-link">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, tzone <span class="op">=</span> <span class="st">"America/Denver"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-04-23 13:49:04 MDT"</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html" class="external-link">with_tz</a></span><span class="op">(</span><span class="va">tt</span>, tzone <span class="op">=</span> <span class="st">"Etc/UTC"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-04-23 19:49:04 UTC"</span></span></code></pre></div>
<p><strong>Google Sheets have no ability to display a moment in time
according to a specified time zone.</strong> Yes, each Sheet has an
associated time zone, but this is not what it influences, even though
you might expect or hope for that.</p>
<p>When we read datetimes out of a Google Sheet, we must:</p>
<ul>
<li>Convert from days to seconds.</li>
<li>Adjust for Unix epoch versus spreadsheet epoch.</li>
<li>Use the resulting number to construct an instance of
<code>POSIXct</code>.</li>
</ul>
<p>When we write a datetime to a Google Sheet, we must:</p>
<ul>
<li>Convert from seconds to days.</li>
<li>Adjust for the spreadsheet epoch versus Unix epoch.</li>
<li>Use the resulting number to create an instance of the <a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/cells#celldata" class="external-link"><code>CellData</code></a>
schema.</li>
</ul>
</div>
<div class="section level2">
<h2 id="datetimes-in-google-sheets">Datetimes in Google Sheets<a class="anchor" aria-label="anchor" href="#datetimes-in-google-sheets"></a>
</h2>
<p>Google Sheets use a spreadsheet-y version of epoch time. A datetime
cell holds a so-called serial number, which is the elapsed days since
the epoch of 30 December 1899 00:00:00 UTC. This number is then
displayed in a more human-friendly way, according to a special token
string. Currently googlesheets4 doesn’t offer any explicit support for
dealing with these <a href="https://developers.google.com/sheets/api/guides/formats#date_and_time_format_patterns" class="external-link">format
strings</a>, although one day it probably will.</p>
<p>Let’s gain some intuition by looking at datetimes shortly after the
epoch and inspecting the underlying serial numbers. In a hidden chunk,
we create a Sheet and read it into R.</p>
<pre><code><span><span class="co">#&gt; Creating new Sheet: "near-the-epoch"</span></span>
<span><span class="co">#&gt; Reading from "near-the-epoch"</span></span>
<span><span class="co">#&gt; Range "dat"</span></span>
<span><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span><span class="co">#&gt;   datetime            serial_number</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 1899-12-30 12:00:00          0.5 </span></span>
<span><span class="co">#&gt; 2 1899-12-31 18:00:00          1.75</span></span></code></pre>
<p>1899-12-30 12:00:00 is noon on the day that is the Google Sheets
epoch. Its underlying serial number is 0.5, because one half-day has
elapsed since the epoch. 1899-12-31 18:00:00 is 6pm in the evening on
the day after the epoch. Its underlying serial number is 1.75, because
it’s one plus three-quarters of a day since the epoch.</p>
<p>Every Google Sheet has an associated time zone. It is included in the
metadata returned by <code><a href="../reference/gs4_get.html">gs4_get()</a></code>, like the locale, and is
revealed by default when we print a Sheets ID.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs4_examples.html">gs4_example</a></span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/gs4_get.html">gs4_get</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Spreadsheet name: gapminder</span></span>
<span><span class="co">#&gt;                 ID: 1U6Cf_qEOhiR9AZqTqS3mbMF3zt2db48ZP5v3rkrAEJY</span></span>
<span><span class="co">#&gt;             Locale: en_US</span></span>
<span><span class="co">#&gt;          Time zone: America/Los_Angeles</span></span>
<span><span class="co">#&gt;        # of sheets: 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Sheet name): (Nominal extent in rows x columns)</span></span>
<span><span class="co">#&gt;       Africa: 625 x 6</span></span>
<span><span class="co">#&gt;     Americas: 301 x 6</span></span>
<span><span class="co">#&gt;         Asia: 397 x 6</span></span>
<span><span class="co">#&gt;       Europe: 361 x 6</span></span>
<span><span class="co">#&gt;      Oceania: 25 x 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Named range): (A1 range)        </span></span>
<span><span class="co">#&gt;        canada: 'Americas'!A38:F49</span></span>
<span></span>
<span><span class="va">meta</span><span class="op">$</span><span class="va">time_zone</span></span>
<span><span class="co">#&gt; [1] "America/Los_Angeles"</span></span></code></pre></div>
<p>However, this time zone has a very different impact – much
<em>less</em> impact – on the user experience than the time zone in
R.</p>
<p>The Sheets’ time zone does <strong>not</strong> influence the display
of datetimes. There is no way to request that a datetime be displayed
according to a specific time zone – not via the Sheet’s time zone, not
via the format string, and not via a Sheets function.</p>
<p>Datetimes in Google Sheets are fundamentally UTC-based and always
display as such.</p>
<p>If you want to see “9:14 am” in your Sheet, you must make sure the
serial number in that cell represents 9:14 in the morning, UTC time.</p>
<p>As far as I can tell, here is the only effect of a Sheet’s time zone:
The formulas <code>=NOW()</code> and <code>=TODAY()</code> take the
local clock time or date, according to the the Sheet’s time zone, and
construct the UTC moment or date that will display as that time or date.
Therefore <code>=NOW()</code>, especially, is almost misleading! It does
not capture the current moment, in UTC, but instead fabricates a UTC
moment that matches current local clock time.</p>
<p>This suggests various hacks if you truly, deeply want to see specific
clock times in your Sheet, for non-UTC time zones.</p>
<p>Starting with the UTC moments, you must determine and apply the
offset yourself. At a very crude level, this can be done from first
principles with datetime arithmetic in the Sheet (“Vancouver is −08:00,
so subtract 8 hours”). But then there’s daylight savings time and other
complexities (“Except, during DST, subtract 7 hours.”). In reality, no
mere mortal will <em>ever</em> get this right, in general. If you doubt
me, please watch the YouTube video <a href="https://youtu.be/-5wpm-gesOY" class="external-link">Computerphile’s “The Problem with
Time &amp; Timezones”</a>.</p>
<p>You need to use external, authoritative offset information, either
within R or in the Sheet. Below, we show how to do this in R. In Sheets,
people tend to use Google Apps script and solutions based on <a href="https://momentjs.com" class="external-link">moment.js</a>.</p>
</div>
<div class="section level2">
<h2 id="worked-example">Worked example<a class="anchor" aria-label="anchor" href="#worked-example"></a>
</h2>
<p>Let’s make all of this concrete. We construct a data frame in R with
a datetime and various versions of it that explore time zone issues. We
also include a couple of Google Sheet formulas, to trigger some datetime
work once the data is written into a Sheet. We sketch the construction
of this data frame here, with considerable abuse of notation (mixing R
code and Sheets formulas):</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="68%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>what</th>
<th>datetime</th>
<th>serial_number</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>moment</td>
<td><code><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time()</a></code></td>
<td><code>=ARRAYFORMULA(TO_PURE_NUMBER(B2:B))</code></td>
</tr>
<tr class="even">
<td>moment_ny</td>
<td><code>with_tz(moment, tzone = "America/New_York")</code></td>
<td></td>
</tr>
<tr class="odd">
<td>moment_utc</td>
<td><code>with_tz(moment, tzone = "Etc/UTC")</code></td>
<td></td>
</tr>
<tr class="even">
<td>moment_ny_force_utc</td>
<td><code>force_tz(moment_ny, tzone = "Etc/UTC")</code></td>
<td></td>
</tr>
<tr class="odd">
<td>=NOW()</td>
<td><code>=NOW()</code></td>
<td></td>
</tr>
<tr class="even">
<td>=(DATE(moment_utc) + TIME(moment_utc))</td>
<td>
<code>=(DATE({year},{month},{day})+time({hour},{minute},{round(second, 1)}))</code>
where <code>year</code>, <code>month</code>, etc. are computed from
<code>moment_utc</code>
</td>
<td></td>
</tr>
</tbody>
</table>
<p>Capture the current <code>moment</code> in time, with
<code><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time()</a></code>, which has no explicit time zone. Store versions
of <code>moment</code> with explicit time zones: America/New_York and
Etc/UTC. Use <code><a href="https://lubridate.tidyverse.org/reference/force_tz.html" class="external-link">lubridate::force_tz()</a></code> to create a new moment
in time: the moment in UTC that has the same clock time as the original
<code>moment</code> in New York.</p>
<p>The first Sheets formula we use is <code>=NOW()</code>, which you
might expect to be the equivalent of R’s <code><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time()</a></code>. But
it’s more like <code>force_tz(Sys.time(), tzone = "Etc/UTC")</code>. The
second formula we construct is more elaborate. It uses datetime
functions in Sheets to explicitly construct <code>moment_utc</code> in
the Sheet. The last column uses <code>=TO_PURE_NUMBER()</code> to reveal
the underlying serial numbers for all of the datetimes.</p>
<p>Create 3 Sheets, with different approaches to the time zone:</p>
<ul>
<li>No explicit specification of time zone. It’s hard to say what you’ll
get here!</li>
<li>America/New_York</li>
<li>Etc/UTC</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_xx</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span><span class="st">"tz-default"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating new Sheet: "tz-default"</span></span>
<span><span class="va">ss_ny</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span><span class="st">"tz-america-new-york"</span>, timeZone <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating new Sheet: "tz-america-new-york"</span></span>
<span><span class="va">ss_utc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs4_create.html">gs4_create</a></span><span class="op">(</span><span class="st">"tz-etc-utc"</span>, timeZone <span class="op">=</span> <span class="st">"Etc/UTC"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating new Sheet: "tz-etc-utc"</span></span>
<span></span>
<span><span class="va">show_timezone</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ss</span><span class="op">)</span> <span class="fu"><a href="../reference/gs4_get.html">gs4_get</a></span><span class="op">(</span><span class="va">ss</span><span class="op">)</span><span class="op">$</span><span class="va">time_zone</span></span>
<span></span>
<span><span class="fu">show_timezone</span><span class="op">(</span><span class="va">ss_xx</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Etc/GMT"</span></span>
<span><span class="fu">show_timezone</span><span class="op">(</span><span class="va">ss_ny</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "America/New_York"</span></span>
<span><span class="fu">show_timezone</span><span class="op">(</span><span class="va">ss_utc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Etc/UTC"</span></span></code></pre></div>
<p>Capture the current <code>moment</code> with <code><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time()</a></code>,
construct the data frame described above, and write it into each of the
prepared Google Sheets.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">populate_sheets</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ss_xx</span>, <span class="va">ss_ny</span>, <span class="va">ss_utc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Writing to "tz-default"</span></span>
<span><span class="co">#&gt; Writing to sheet "Sheet1"</span></span>
<span><span class="co">#&gt; Editing "tz-default"</span></span>
<span><span class="co">#&gt; Resizing one or more columns in "Sheet1"</span></span>
<span><span class="co">#&gt; Editing "tz-default"</span></span>
<span><span class="co">#&gt; Editing sheet "Sheet1"</span></span>
<span><span class="co">#&gt; Writing to "tz-america-new-york"</span></span>
<span><span class="co">#&gt; Writing to sheet "Sheet1"</span></span>
<span><span class="co">#&gt; Editing "tz-america-new-york"</span></span>
<span><span class="co">#&gt; Resizing one or more columns in "Sheet1"</span></span>
<span><span class="co">#&gt; Editing "tz-america-new-york"</span></span>
<span><span class="co">#&gt; Editing sheet "Sheet1"</span></span>
<span><span class="co">#&gt; Writing to "tz-etc-utc"</span></span>
<span><span class="co">#&gt; Writing to sheet "Sheet1"</span></span>
<span><span class="co">#&gt; Editing "tz-etc-utc"</span></span>
<span><span class="co">#&gt; Resizing one or more columns in "Sheet1"</span></span>
<span><span class="co">#&gt; Editing "tz-etc-utc"</span></span>
<span><span class="co">#&gt; Editing sheet "Sheet1"</span></span></code></pre></div>
<p>First, let’s look at <code>dat</code>, the data frame we sent.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span></span>
<span><span class="co">#&gt; # A tibble: 6 x 3</span></span>
<span><span class="co">#&gt;   what                datetime   serial_number                      </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;               &lt;list&gt;     &lt;fmla&gt;                             </span></span>
<span><span class="co">#&gt; 1 moment              &lt;dttm [1]&gt; =ARRAYFORMULA(TO_PURE_NUMBER(B2:B))</span></span>
<span><span class="co">#&gt; 2 moment_ny           &lt;dttm [1]&gt; NA                                 </span></span>
<span><span class="co">#&gt; 3 moment_utc          &lt;dttm [1]&gt; NA                                 </span></span>
<span><span class="co">#&gt; 4 moment_ny_utc_force &lt;dttm [1]&gt; NA                                 </span></span>
<span><span class="co">#&gt; 5 =NOW()              &lt;fmla&gt;     NA                                 </span></span>
<span><span class="co">#&gt; 6 =DATE(moment_utc)   &lt;fmla&gt;     NA</span></span></code></pre></div>
<p>That’s hard to parse since the <code>datetime</code> column is a
list-column. Here’s a different look, with the most natural character
representation of that column.</p>
<pre><code><span><span class="co">#&gt; # A tibble: 6 x 3</span></span>
<span><span class="co">#&gt;   what             datetime                     serial_number                      </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;                        &lt;fmla&gt;                             </span></span>
<span><span class="co">#&gt; 1 moment           2020-04-23 12:49:20 PDT      =ARRAYFORMULA(TO_PURE_NUMBER(B2:B))</span></span>
<span><span class="co">#&gt; 2 moment_ny        2020-04-23 15:49:20 EDT      NA                                 </span></span>
<span><span class="co">#&gt; 3 moment_utc       2020-04-23 19:49:20 UTC      NA                                 </span></span>
<span><span class="co">#&gt; 4 moment_ny_utc_f… 2020-04-23 15:49:20 UTC      NA                                 </span></span>
<span><span class="co">#&gt; 5 =NOW()           =NOW()                       NA                                 </span></span>
<span><span class="co">#&gt; 6 =DATE(moment_ut… =(DATE(2020,4,23)+time(19,4… NA</span></span></code></pre>
<p>Read the Sheets back into R, the Sheet with no explicit time zone
set.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss_xx</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading from "tz-default"</span></span>
<span><span class="co">#&gt; Range "Sheet1"</span></span>
<span><span class="co">#&gt;                  what            datetime serial_number</span></span>
<span><span class="co">#&gt; 1              moment 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 2           moment_ny 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 3          moment_utc 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 4 moment_ny_utc_force 2020-04-23 15:49:20      43944.66</span></span>
<span><span class="co">#&gt; 5              =NOW() 2020-04-23 19:49:22      43944.83</span></span>
<span><span class="co">#&gt; 6   =DATE(moment_utc) 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="fu"><a href="../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss_ny</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading from "tz-america-new-york"</span></span>
<span><span class="co">#&gt; Range "Sheet1"</span></span>
<span><span class="co">#&gt;                  what            datetime serial_number</span></span>
<span><span class="co">#&gt; 1              moment 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 2           moment_ny 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 3          moment_utc 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 4 moment_ny_utc_force 2020-04-23 15:49:20      43944.66</span></span>
<span><span class="co">#&gt; 5              =NOW() 2020-04-23 15:49:23      43944.66</span></span>
<span><span class="co">#&gt; 6   =DATE(moment_utc) 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="fu"><a href="../reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="va">ss_utc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading from "tz-etc-utc"</span></span>
<span><span class="co">#&gt; Range "Sheet1"</span></span>
<span><span class="co">#&gt;                  what            datetime serial_number</span></span>
<span><span class="co">#&gt; 1              moment 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 2           moment_ny 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 3          moment_utc 2020-04-23 19:49:20      43944.83</span></span>
<span><span class="co">#&gt; 4 moment_ny_utc_force 2020-04-23 15:49:20      43944.66</span></span>
<span><span class="co">#&gt; 5              =NOW() 2020-04-23 19:49:25      43944.83</span></span>
<span><span class="co">#&gt; 6   =DATE(moment_utc) 2020-04-23 19:49:20      43944.83</span></span></code></pre></div>
<p>Main conclusions:</p>
<ul>
<li>All 3 versions of <code>moment</code> result in the same serial
number in all 3 Sheets. Lesson: in R, time zone is merely a matter of
display and, in Sheets, there is only UTC.</li>
<li>
<code>moment_ny_utc_force</code> (forcing <code>moment</code>s NY
clock time into UTC) results in the same serial number in all 3 Sheets.
Lesson: If you want to see a specify clock time in the Sheet, force this
on the R side, before writing to Sheets. But realize that you have
fudged the datetime data in order to get the desired display.</li>
<li>
<code>=NOW()</code> is one of the few things affected by a Sheet’s
time zone (along with <code>=TODAY()</code>. It allows you to force the
Sheet’s clock time into UTC.</li>
</ul>
<p>Clean up.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gs4_find.html">gs4_find</a></span><span class="op">(</span><span class="st">"tz-"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">googledrive</span><span class="fu">::</span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_trash.html" class="external-link">drive_trash</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Files trashed:</span></span>
<span><span class="co">#&gt;   * tz-etc-utc: 1xUiNXYsk6nDMmgDq8E5FhBwJA6Zg1XCyhkuQISI91As</span></span>
<span><span class="co">#&gt;   * tz-america-new-york: 1RYjk25FKJH2QRpfT1fHGmomeO2BQ5VqErWQADLGeFJI</span></span>
<span><span class="co">#&gt;   * tz-default: 1X9Zqe--GLw6X4jajyHVb9XmKh-AiLMwZKk_g5GoJl3Y</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
